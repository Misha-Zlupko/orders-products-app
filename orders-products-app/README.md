# Orders & Products (SPA)

Учёт заказов и продуктов, корзина, JWT‑авторизация, личные заказы по аккаунту, счётчик активных сессий по WebSocket (Socket.io).  
Тестовое задание уровня **Junior+**.

Автор: **Misha**

---

## 1. Что делает приложение

- **Навигация и страницы**

  - Главная: ссылки на `Orders` и `Products`, карта, график заказов, количество продуктов.
  - `Products`: каталог продуктов, фильтр по типу (select), таблица, кнопка «Добавить в корзину».
  - `Cart`: корзина с позициями, изменением количества, суммой и оформлением заказа.
  - `Orders`: список заказов текущего пользователя, детали заказа, сумма в разных валютах, удаление с подтверждением.
  - `Auth`: страницы логина и регистрации.

- **TopMenu и WebSocket**

  - В правом верхнем углу: **дата и время в реальном времени**.
  - **Счётчик активных вкладок**: Socket.io считает количество открытых вкладок приложения во всех браузерах.

- **Бизнес‑логика**

  - Продукты и корзина хранятся в **Redux** (с `redux-persist` в `localStorage`).
  - Заказы привязаны к конкретному пользователю по `userId` из **JWT‑токена**.
  - Формы логина/регистрации с валидацией (`Formik + Yup`).
  - Фильтр продуктов по типу, расчёт сумм заказов и корзины в нескольких валютах.

- **UI и эффекты**
  - **Bootstrap 5 + bootstrap‑icons** для базовой вёрстки.
  - **БЭМ‑нейминг** для собственных CSS‑классов.
  - Анимации переходов и появления блоков через **animate.css / framer‑motion**.
  - Lazy Loading тяжёлых компонентов (карта, график, таблица).
  - i18n: интерфейс на **украинском и английском**, переключатель языка в шапке.

Подробнее об архитектуре: `docs/ARCHITECTURE.md`.  
Описание схемы БД: `docs/SCHEMA.md` (`data/schema.sql` для DDL).

---

## 2. Технологии (по требованиям тестового)

- **Frontend**

  - React 19, **Next.js (App Router, SSR)**, TypeScript
  - Компонентный подход, маршрутизация страниц `app/*`
  - Анимации: **animate.css**, framer‑motion
  - CSS‑архитектура **БЭМ**, CSS‑фреймворк **Bootstrap 5**
  - i18n (UK/EN), Google Maps, Charts (Chart.js + react‑chartjs‑2)

- **Состояние и данные**

  - **Redux Toolkit**, `react-redux`
  - `redux-persist` + WebStorage (`localStorage`) для корзины и заказов
  - React Context: Auth, Socket, Locale
  - REST‑вызовы через **axios/fetch** (`app/api/auth/*`, `lib/api`)

- **Авторизация и безопасность**

  - JWT (jsonwebtoken) для логина/регистрации
  - Хэширование пароля через bcryptjs

- **WebSocket**

  - Socket.io (server + client) для счётчика активных сессий

- **Тестирование и качество кода**

  - Vitest + React Testing Library + jest‑dom
  - ESLint (конфиг Next.js)

- **Инфраструктура**
  - Node.js + Next.js кастомный сервер (`server.js`) с Socket.io
  - **Docker / docker compose** для развёртывания
  - Git‑репозиторий с историей коммитов и документацией

---

## 3. Структура проекта (кратко)

Подробно описано в `docs/ARCHITECTURE.md`. Краткий обзор:

| Папка / файл            | Назначение                                                                                                                                              |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `app/`                  | Маршруты Next.js: главная, корзина, заказы, продукты, логин/регистрация. `app/api/auth/*` — API‑роуты для логина/регистрации/`me`.                      |
| `app/page.tsx`          | Главная страница: ссылки на основные разделы, карта, график, счётчики.                                                                                  |
| `app/cart/page.tsx`     | Страница корзины.                                                                                                                                       |
| `app/orders/page.tsx`   | Страница заказов пользователя, список + детали.                                                                                                         |
| `app/products/page.tsx` | Каталог продуктов с фильтрами и таблицей.                                                                                                               |
| `components/`           | Фичевые React‑компоненты: `cart/`, `orders/`, `products/`, `layout/` (Header, Sidebar, TopMenu), `home/` (карта, график), общие компоненты (`common/`). |
| `contexts/`             | Контексты: авторизация (`AuthContext`), язык (`LocaleContext`), сокеты (`SocketContext`).                                                               |
| `store/`                | Redux‑слой: слайсы, селекторы, `persistConfig`, хуки.                                                                                                   |
| `lib/`                  | Бизнес‑логика и API‑клиенты: JWT, работа с пользователями, REST‑вызовы.                                                                                 |
| `data/`                 | Исходные in‑memory данные (каталог продуктов и т.п.), DDL для базы (`schema.sql`).                                                                      |
| `types/`                | Общие TypeScript‑типы (orders, products, cart, auth).                                                                                                   |
| `utils/`                | Хелперы (`cartUtils`, `dateFormatter` и др.).                                                                                                           |
| `locales/`              | Файлы переводов i18n (`uk.json`, `en.json`).                                                                                                            |
| `server.js`             | Кастомный сервер: Next.js + Socket.io для счётчика вкладок.                                                                                             |
| `docs/ARCHITECTURE.md`  | Подробная архитектура и потоки данных.                                                                                                                  |
| `docs/SCHEMA.md`        | Описание схемы БД и связей.                                                                                                                             |

---

## 4. Установка и локальный запуск

### 4.1. Зависимости

```bash
npm install
```

### 4.2. Переменные окружения

Создайте `.env.local` и задайте как минимум:

```bash
JWT_SECRET=your_jwt_secret_here
PORT=3000          # по умолчанию 3000, можно не указывать
```

### 4.3. Запуск в dev‑режиме

Полное приложение (Next.js + Socket.io):

```bash
npm run dev
```

Откройте в браузере: http://localhost:3000

Только Next.js без Socket.io (если нужно):

```bash
npm run dev:next
```

### 4.4. Production‑сборка

```bash
npm run build
npm run start        # старт через server.js (Next + Socket.io)
```

Либо чистый Next.js без сокетов:

```bash
npm run start:next
```

---

## 5. Docker

Приложение упаковано в Docker‑контейнер с окружением и зависимостями.

```bash
docker compose up --build
```

После сборки и запуска приложение будет доступно по адресу:  
http://localhost:3000

Перед первым запуском убедитесь, что:

- Docker Desktop установлен и запущен;
- команда `docker` доступна в терминале (в Windows PowerShell может понадобиться запуск от администратора).

---

## 6. Тесты (Unit‑тесты)

Используются **Vitest** + **React Testing Library**.

```bash
npm run test         # watch-режим
npm run test:run     # один прогон
npm run test:coverage
```

Основные тесты лежат в папке `__tests__/` и покрывают:

- утилиты (`cartUtils`, `dateFormatter` и др.);
- Redux‑слайсы `cart` и `orders` + селекторы;
- API‑клиент авторизации (мок fetch/axios);
- работу с JWT;
- пример тестирования React‑компонента (`EmptyCart` и др.).

---

## 7. Схема базы данных (для MySQL Workbench)

Описание сущностей и связей находится в:

- `docs/SCHEMA.md` — текстовое описание таблиц и связей;
- `data/schema.sql` — базовый DDL (SQLite‑совместимый);
- `data/schema-mysql.sql` — готовый DDL **специально для MySQL Workbench**.

Как открыть схему в MySQL Workbench:

1. Запустить **MySQL Workbench** и подключиться к своему серверу.
2. В меню выбрать `File → Open SQL Script…` и открыть `data/schema-mysql.sql`.
3. Нажать кнопку **Execute** (молния), чтобы выполнить скрипт.
4. В списке схем появится база `orders_products` со всеми таблицами (`users`, `orders`, `order_items`, `products`, `product_prices`), которые можно визуально сравнить с реализованными сущностями в приложении.

---

## 8. Как проверить проект по Readme (самопроверка)

1. Клонировать репозиторий:

   ```bash
   git clone <url>
   cd orders-products-app
   ```

2. Установить зависимости:

   ```bash
   npm install
   ```

3. Создать `.env.local` c `JWT_SECRET`.

4. Запустить dev‑режим:

   ```bash
   npm run dev
   ```

5. Открыть http://localhost:3000 и пройти сценарии:

   - регистрация / логин;
   - добавление продуктов в корзину и создание заказа;
   - просмотр и удаление своих заказов;
   - переключение языка (UK/EN);
   - открытие приложения в нескольких вкладках и проверка счётчика активных сессий;
   - переходы между страницами и анимации.

6. При необходимости — запустить тесты (`npm run test`) и Docker‑сборку (`docker compose up --build`).

Проект готов к проверке по чек‑листу ТЗ.
